"use strict";var appShorts=appShorts||{};appShorts.refs.body=document.querySelector("html, body"),appShorts.refs.mobile_main_menu=document.querySelector("#mobile_main_menu"),appShorts.refs.overlay_background=document.querySelector("#overlay_background"),appShorts.refs.footerBar=document.querySelector(".footer_bar"),appShorts.refs.askForNotification=document.querySelector("#askForNotification"),appShorts.refs.askForNotificationYes=document.querySelector("#askForNotification button.yes"),appShorts.refs.askForNotificationNo=document.querySelector("#askForNotification button.no"),appShorts.data_json=[],appShorts.getSinglePost=function(t,e,o){appShorts.fetchResp.singlePostResp||(appShorts.data_json.every(function(o){if(o.slug===e)return appShorts.populateSinglePost(t,e,o),!0}),appShorts.apiCall("GET",appShorts.url.base+appShorts.url.apiGetPostsPath+o).then(function(o){appShorts.populateSinglePost(t,e,o)}))},appShorts.removeSinglePost=function(){appShorts.refs.mainPostWrapper.style.display="none"},appShorts.getList=function(t){if(!appShorts.fetchResp.postResp){appShorts.addEvent.ajaxStart();var e=appShorts.url.base+appShorts.url.apiGetPostsPath;e+="?number="+appShorts.url.per_page+"&offset="+appShorts.url.offset,t&&(e+="&category="+(t=t.toLowerCase()));var o=function(e){appShorts.populateList(t,e)};appShorts.apiCall("GET",e).then(function(t){appShorts.addEvent.ajaxStop(),o(t)}).catch(function(){appShorts.getDataFromDB("posts",o),appShorts.addEvent.ajaxStop()})}},appShorts.getCategories=function(){appShorts.fetchResp.catResp||(appShorts.addEvent.ajaxStart(),appShorts.apiCall("GET",appShorts.url.base+appShorts.url.apiGetCategoriesPath).then(function(t){appShorts.populateCategories(t),appShorts.addEvent.ajaxStop()}).catch(function(){appShorts.getDataFromDB("categories",appShorts.populateCategories),appShorts.addEvent.ajaxStop()}))},(appShorts=appShorts||{}).get_promise_base=function(){return{resolve:function(t){if(this.then_callback)return this.then_callback(t);this.data=t},reject:function(t){if(this.catch)return this.catch(t);this.data=t},then:function(t){if(this.data)return t.call(this,this.data);this.then_callback=t},catch:function(t){if(this.data)return t.call(this,this.data);this.data=null,this.catch_callback=t}}},appShorts.promise=function(t){var e=appShorts.get_promise_base();return t(e.resolve.bind(e),e.reject.bind(e))},(appShorts=appShorts||{}).route=function(){var t=function(){var t=appShorts.getUrlParams();t?t.title?(appShorts.getSinglePost(t.category,t.title,t.id),appShorts.getList(t.category)):(appShorts.removeSinglePost(),appShorts.getList(t.category)):(appShorts.removeSinglePost(),appShorts.getList())};window.onhashchange=function(){t()},t(),appShorts.addEvent.askForEmailEvents(),appShorts.addEvent.ajaxStart(),appShorts.addEvent.ajaxStop(),appShorts.addEvent.loadMore()},(appShorts=appShorts||{}).apiCall=function(t,e,o){var a=function(a,r){var s=new XMLHttpRequest;s.onload=function(){4==this.readyState&&200==this.status?a(JSON.parse(s.responseText)):r(s.responseText)},s.open(t,e,!0),s.setRequestHeader("Content-type","application/json"),s.send(JSON.stringify(o))};if(Promise)return new Promise(function(t,e){a(t,e)});appShorts.promise(function(t,e){a(t,e)})},appShorts.addEvent.askForNotification=function(){appShorts.refs.askForNotification.style.display="block";var t=function(){appShorts.refs.askForNotification.style.display="none"};appShorts.refs.askForNotificationYes.addEventListener("click",function(){appShorts.registerDevice(),t()}),appShorts.refs.askForNotificationNo.addEventListener("click",function(){t()})},appShorts.addEvent.loadingOnScroll=!1,appShorts.addEvent.loadMore=function(){document.getElementById("showMore").addEventListener("click",function(t){if(t.preventDefault(),appShorts.url.loadMore){var e=appShorts.getUrlParams()||{};appShorts.getList(e.category)}else this.style.display="none"})},appShorts.addEvent.askForEmailEvents=function(){function t(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}function e(t){return{email:t,category:appShorts.selectedCategory}}var o=document.getElementById("register_email"),a=document.getElementsByClassName("register_success_box")[0],r=document.getElementsByClassName("register_error_box")[0];document.getElementById("register_button").addEventListener("click",function(s){var n=o.value;n&&(t(n)?(a.style.display="block",r.style.display="none",appShorts.apiCall("POST","https://34.228.255.247/registerDevice/",e(n)).then(function(){console.log("Device Id Registered ")}).catch(function(t){console.log("Device Id Registration Error "+t)})):(a.style.display="none",r.style.display="block"))});var s=document.getElementById("email_newsletter"),n=document.getElementsByClassName("newsletter_success_box")[0],i=document.getElementsByClassName("newsletter_error_box")[0];document.getElementById("submit-button-newsletter").addEventListener("click",function(o){var a=s.value;a&&(n.style.display="block",i.style.display="none",t(a)?appShorts.apiCall("POST","https://34.228.255.247/registerDevice/",e(a)).then(function(){console.log("Device Id Registered ")}).catch(function(t){console.log("Device Id Registration Error "+t)}):(n.style.display="none",i.style.display="block"))})},appShorts.addEvent.showMobileMenu=function(){appShorts.refs.mobile_main_menu.style.display="block"},appShorts.addEvent.hideMobileMenu=function(){appShorts.refs.mobile_main_menu.style.display="none"},appShorts.addEvent.showMenuOnClickingHamburger=function(){document.querySelector("#hamburger").addEventListener("click",function(t){appShorts.addEvent.showMobileMenu(),t.stopPropagation()}),document.querySelector("#close_menu").addEventListener("click",function(t){appShorts.addEvent.hideMobileMenu()})},(appShorts=appShorts||{}).registerDevice=function(){"serviceWorker"in navigator&&appShorts.registerServiceWorker()},appShorts.registerServiceWorker=function(){var t=function(t){var e=(t=JSON.parse(JSON.stringify(t))).endpoint,o={};return o.deviceId=e.replace("https://android.googleapis.com/gcm/send/",""),o.keys={},o.keys.p256dh=t.keys.p256dh,o.keys.auth=t.keys.auth,o},e=function(t){appShorts.apiCall("POST","https://34.228.255.247/registerDevice/",t).then(function(){console.log("Device Id Registered ")}).catch(function(t){console.log("Device Id Registration Error "+t)})},o=function(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(e),a=new Uint8Array(o.length),r=0;r<o.length;++r)a[r]=o.charCodeAt(r);return a};navigator.serviceWorker.register("sw.js",{scope:"./"}).then(function(a){console.log("Service worker registration succeeded:",a),navigator.serviceWorker.ready.then(function(a){var r=o("BMqjdFAkcCw3MjPNAWKY4BlAn-rggk3oa2Dn1lTKNKqWGns01DB-hAkTaGOiUbGHsjIlckOhqqlyrCRGUDbWtSM");a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r}).then(function(o){console.log("Subscription for Push successful");var a=t(o);e(a)}).catch(function(t){console.log("Subscription for Push failed",t)})})}).catch(function(t){console.log("Service worker registration failed:",t)})},appShorts.askForNotificationPermission=function(){return window.Notification&&"default"===window.Notification.permission};